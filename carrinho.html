<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Carrinho - Tchê Pneus</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --vermelho: #d60000;
  --verde: #009b48;
  --verde-hover: #007a39;
  --cinza: #f5f5f5;
  --preto: #111;
  --texto: #333;
}
* { box-sizing: border-box; }
body {
  font-family: 'Poppins', sans-serif;
  background: var(--cinza);
  color: var(--texto);
  margin: 0;
}
header {
  background: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 28px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
header h1 { color: var(--vermelho); font-size: 22px; margin: 0; }
main {
  max-width: 920px;
  margin: 38px auto;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,.08);
  padding: 26px;
}
h2 {
  margin: 0 0 18px;
  text-align: center;
  font-size: 22px;
}
.cart-item {
  display: grid;
  grid-template-columns: 100px 1fr auto;
  gap: 16px;
  align-items: center;
  padding: 16px 0;
  border-bottom: 1px solid #eee;
}
.cart-item img {
  width: 100px; height: auto; border-radius: 8px; background: #fff;
}
.item-info h3 { margin: 0; font-size: 16px; font-weight: 600; }
.item-info p { margin: 6px 0 0; color:#666; font-size: 14px; }
.item-actions {
  display:flex; align-items:center; gap:10px; justify-content:flex-end;
}
.qty-select {
  padding: 6px 8px; border:1px solid #ccc; border-radius:6px; font-size:14px;
}
.item-price { font-weight:700; color:var(--verde); min-width:110px; text-align:right; }
.remove-btn {
  width:30px; height:30px; border-radius:50%;
  border:1px solid #f1c2c2; color:#ff4a4a; background:#ffecec;
  cursor:pointer; font-size:16px; line-height:28px; text-align:center;
}
.remove-btn:hover { background:#ffd9d9; }
.total { text-align:right; font-weight:700; margin-top:18px; font-size:18px; }

.frete { margin-top:26px; }
.frete label { display:block; font-weight:600; margin-bottom:8px; }
.frete-row { display:flex; gap:10px; flex-wrap:wrap; }
.frete input {
  width:220px; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:14px;
}
.btn-calcular {
  background:#ccc; color:#fff; border:none; padding:10px 14px;
  border-radius:8px; font-weight:600; cursor:not-allowed; transition:.25s;
}
.btn-calcular.ativo { background:var(--verde); cursor:pointer; }
.btn-calcular.ativo:hover { background:var(--verde-hover); }
.resultado-frete { margin-top:10px; color:var(--verde); font-weight:600; font-size:14px; }

.btn-continuar {
  width:100%; padding:14px; margin-top:28px; border:none; border-radius:10px;
  background:#ccc; color:#fff; font-weight:700; font-size:16px; cursor:not-allowed;
  transition:.25s;
}
.btn-continuar.ativo { background:var(--verde); cursor:pointer; }
.btn-continuar.ativo:hover { background:var(--verde-hover); }

footer {
  background: var(--preto); color:#eee; text-align:center; padding:14px 0; margin-top:40px;
  font-size:14px;
}

@media (max-width: 768px) {
  main { margin:20px; padding:20px; }
  .cart-item { grid-template-columns:80px 1fr; }
  .item-actions { grid-column: 1 / -1; justify-content:flex-start; }
  .item-price { text-align:left; }
  .total { text-align:center; }
  .frete-row { flex-direction:column; }
  .frete input { width:100%; }
}
@media (max-width:480px) { header { flex-direction:column; gap:8px; } }
</style>
</head>
<body>

<header>
  <h1>Tchê Pneus</h1>
  <div>Seu carrinho</div>
</header>

<main>
  <h2>Resumo do Pedido</h2>

  <div id="cartItems"></div>
  <div id="total" class="total"></div>

  <div class="frete">
    <label for="cep">Calcule o frete</label>
    <div class="frete-row">
      <input type="text" id="cep" placeholder="Digite seu CEP" />
      <button id="btnCalcular" class="btn-calcular">Calcular</button>
    </div>
    <div id="resultadoFrete" class="resultado-frete"></div>
  </div>

  <button id="btnContinuar" class="btn-continuar">CONTINUAR</button>
</main>

<footer>© 2025 Tchê Pneus — Revendedora licenciada XBRI. Todos os direitos reservados.</footer>

<script>
const cartContainer = document.getElementById('cartItems');
const totalEl        = document.getElementById('total');
const cepInput       = document.getElementById('cep');
const btnCalcular    = document.getElementById('btnCalcular');
const resFrete       = document.getElementById('resultadoFrete');
const btnContinuar   = document.getElementById('btnContinuar');

let cart = JSON.parse(localStorage.getItem('cart') || '[]');
let freteOk = false;

// Formata BRL
const BRL = new Intl.NumberFormat('pt-BR',{ style:'currency', currency:'BRL' });

// Converte qualquer formato de preço (string/number) para número com ponto decimal
function toNumber(val){
  if (typeof val === 'number' && !isNaN(val)) return val;
  if (typeof val === 'string'){
    // remove tudo que não é dígito, vírgula ou ponto
    let s = val.replace(/[^\d,.-]/g,'').trim();
    // remove separadores de milhar
    s = s.replace(/\.(?=\d{3}(\D|$))/g,'');
    // vírgula decimal -> ponto
    s = s.replace(',', '.');
    const n = parseFloat(s);
    if (!isNaN(n)) return n;
  }
  return 0;
}

function updateContinueState(){
  if (cart.length > 0 && freteOk){
    btnContinuar.classList.add('ativo');
    btnContinuar.disabled = false;
  } else {
    btnContinuar.classList.remove('ativo');
    btnContinuar.disabled = true;
  }
}

function renderCart(){
  cartContainer.innerHTML = '';
  let total = 0;

  if (cart.length === 0){
    cartContainer.innerHTML = '<p>Seu carrinho está vazio.</p>';
    totalEl.textContent = '';
    freteOk = false;
    updateContinueState();
    // Redireciona depois de 2s
    setTimeout(()=>{ window.location.href = 'index.html'; }, 2000);
    return;
  }

  cart.forEach((item, idx) => {
    const unit = toNumber(item.price);       // robusto para "R$ 979,00", "979.00", 979 etc.
    const qty  = Number(item.quantity || 1);
    const subtotal = unit * qty;
    total += subtotal;

    const row = document.createElement('div');
    row.className = 'cart-item';
    row.innerHTML = `
      <img src="${item.image}" alt="${item.name}">
      <div class="item-info">
        <h3>${item.name}</h3>
        <p>${BRL.format(unit)}</p>
      </div>
      <div class="item-actions">
        <select class="qty-select" data-index="${idx}">
          ${Array.from({length:10}, (_,i)=>`<option value="${i+1}" ${qty===i+
