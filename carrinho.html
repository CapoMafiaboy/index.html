<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrinho - Tchê Pneus</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --vermelho: #d60000;
  --verde: #008b2f;
  --cinza: #f4f4f4;
  --texto: #333;
  --preto: #111;
}
body {
  font-family: 'Poppins', sans-serif;
  background: var(--cinza);
  color: var(--texto);
  margin: 0;
}
header {
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px 40px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
header h1 {
  color: var(--vermelho);
  font-size: 22px;
  margin: 0;
}
.container {
  max-width: 900px;
  margin: 40px auto;
  background: #fff;
  border-radius: 10px;
  padding: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
h2 {
  text-align: center;
  font-size: 22px;
  color: var(--texto);
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  text-align: left;
  padding: 10px;
}
th {
  border-bottom: 2px solid #eee;
}
td img {
  width: 70px;
  border-radius: 6px;
}
.remove-btn {
  background: none;
  border: none;
  color: var(--vermelho);
  font-size: 20px;
  cursor: pointer;
}
.total {
  text-align: right;
  font-weight: 700;
  margin-top: 10px;
}
button {
  border: none;
  padding: 12px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { opacity: 0.9; }
#continuar {
  background: var(--verde);
  color: #fff;
  width: 100%;
}
#continuar:disabled {
  background: #ccc;
  cursor: not-allowed;
}
#calcular {
  background: var(--verde);
  color: #fff;
}
#cep {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  width: 200px;
}
footer {
  background: var(--preto);
  color: #eee;
  text-align: center;
  padding: 15px 0;
  margin-top: 40px;
}
</style>
</head>
<body>

<header>
  <h1>Tchê Pneus</h1>
  <div>Seu carrinho</div>
</header>

<div class="container">
  <h2>Resumo do Pedido</h2>

  <table id="cartTable">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Qtd</th>
        <th>Valor Unitário</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="total" id="totalContainer"></div>

  <div style="margin-top:20px;">
    <label for="cep"><b>Calcule o frete</b></label><br>
    <input type="text" id="cep" placeholder="Digite seu CEP">
    <button id="calcular">Calcular</button>
    <p id="freteInfo"></p>
  </div>

  <button id="continuar" disabled>CONTINUAR</button>
</div>

<footer>
  © 2025 Tchê Pneus — Revendedora licenciada XBRI. Todos os direitos reservados.
</footer>

<script>
const cartBody = document.getElementById("cartBody");
const totalContainer = document.getElementById("totalContainer");
const continuarBtn = document.getElementById("continuar");
const freteInfo = document.getElementById("freteInfo");
const cepInput = document.getElementById("cep");
const calcularBtn = document.getElementById("calcular");

// --- Converte qualquer valor monetário para número real ---
function toNumber(value) {
  if (!value) return 0;
  return parseFloat(value.toString().replace(/[^\d,.-]/g, "").replace(",", "."));
}

// --- Carrega produtos do localStorage ---
function loadCart() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cartBody.innerHTML = "";

  if (cart.length === 0) {
    cartBody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#888;">Seu carrinho está vazio.</td></tr>`;
    totalContainer.textContent = "";
    setTimeout(() => window.location.href = "index.html", 2000);
    return;
  }

  cart.forEach((item, index) => {
    const price = toNumber(item.price);
    const quantity = item.quantity || 1;
    const subtotal = price * quantity;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td><img src="${item.image}" alt="${item.name}"> ${item.name}</td>
      <td><input type="number" value="${quantity}" min="1" style="width:60px"></td>
      <td>R$ ${price.toFixed(2)}</td>
      <td>R$ ${(subtotal).toFixed(2)}</td>
      <td><button class="remove-btn" data-index="${index}">✖</button></td>
    `;
    cartBody.appendChild(row);
  });

  updateTotal();
}

// --- Atualiza total ---
function updateTotal() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  let total = 0;
  cart.forEach(item => total += toNumber(item.price) * (item.quantity || 1));
  totalContainer.textContent = `Total: R$ ${total.toFixed(2)}`;
}

// --- Atualiza quantidades ---
cartBody.addEventListener("input", e => {
  if (e.target.type === "number") {
    const index = Array.from(cartBody.children).indexOf(e.target.closest("tr"));
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart[index].quantity = parseInt(e.target.value);
    localStorage.setItem("cart", JSON.stringify(cart));
    loadCart();
  }
});

// --- Remove produto ---
cartBody.addEventListener("click", e => {
  if (e.target.classList.contains("remove-btn")) {
    const index = e.target.dataset.index;
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    loadCart();
  }
});

// --- Valida CEP e habilita botão ---
let cepValido = false;
calcularBtn.addEventListener("click", () => {
  const cep = cepInput.value.replace(/\D/g, "");
  const cart = JSON.parse(localStorage.getItem("cart")) || [];

  if (cep.length !== 8) {
    freteInfo.textContent = "Digite um CEP válido.";
    freteInfo.style.color = "red";
    cepValido = false;
  } else if (cart.length === 0) {
    freteInfo.textContent = "Carrinho vazio. Redirecionando...";
    freteInfo.style.color = "red";
    setTimeout(() => window.location.href = "index.html", 2000);
    cepValido = false;
  } else {
    freteInfo.textContent = "FRETE GRÁTIS - Prazo de entrega: 4 a 5 dias úteis";
    freteInfo.style.color = "black";
    cepValido = true;
  }

  continuarBtn.disabled = !(cepValido && cart.length > 0);
});

// --- Continuar ---
continuarBtn.addEventListener("click", () => {
  if (cepValido) {
    window.location.href = "identificacao.html";
  }
});

loadCart();
</script>
</body>
</html>
