<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Confirmação do Pedido — Tchê Pneus</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
:root{--red:#d60000;--green:#009b48;--green-hover:#007a39;--bg:#f5f5f5;--text:#333}
*{box-sizing:border-box}
body{margin:0;font-family:Poppins,sans-serif;background:var(--bg);color:var(--text)}
header{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.header-inner{max-width:900px;margin:0 auto;padding:14px 20px;display:flex;align-items:center}
.brand{color:var(--red);font-weight:700;font-size:22px}
main{max-width:900px;margin:28px auto;padding:0 20px;display:grid;gap:18px}
.card{background:#fff;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,.08);padding:18px}
h2{margin:6px 0 12px}
.section-title{font-weight:700;margin-bottom:8px}
.summary-row{display:flex;gap:10px;justify-content:space-between;border-bottom:1px solid #eee;padding:10px 0}
.summary-row img{width:64px;height:64px;object-fit:contain;border-radius:8px;background:#fff}
.total{font-weight:700;text-align:right;margin-top:10px}
.notice{background:#fff8e6;border:1px solid #ffe1a7;color:#8a6100;border-radius:10px;padding:12px;line-height:1.5}
.btn{width:100%;border:none;border-radius:10px;padding:12px 14px;background:var(--green);color:#fff;font-weight:700;cursor:pointer;margin-top:10px}
.btn:hover{background:var(--green-hover)}
footer{color:#666;text-align:center;padding:24px 10px}
/* mobile */
@media (max-width:720px){
  .summary-row{flex-direction:column;align-items:flex-start}
  .total{text-align:left}
}
</style>
</head>
<body>
<header><div class="header-inner"><div class="brand">Tchê Pneus</div><div style="margin-left:auto">Confirmação</div></div></header>

<main>
  <div class="card" id="clienteBox">
    <h2>Dados do cliente</h2>
    <div id="cliente"></div>
  </div>

  <div class="card">
    <h2>Resumo do pedido</h2>
    <div id="resumo"></div>
    <div id="total" class="total"></div>
  </div>

  <div class="card">
    <div class="section-title">Atenção para o pagamento na entrega</div>
    <div class="notice"><strong>Para efetuar o pagamento na entrega</strong>, será necessário baixar o aplicativo da transportadora para verificação de titularidade, gerar o código de rastreio, acompanhar a entrega em tempo real e obter o <strong>QR CODE</strong> que será escaneado pelo entregador.</div>
    <button id="whats" class="btn">Confirmar pedido no WhatsApp</button>
  </div>
</main>

<footer>© 2025 Tchê Pneus — Revendedora licenciada XBRI. Todos os direitos reservados.</footer>

<script>
const BRL=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});
function getCart(){ try{ return JSON.parse(localStorage.getItem('cart'))||[] }catch{ return [] } }

const clienteBox=document.getElementById('cliente');
const resumo=document.getElementById('resumo');
const totalEl=document.getElementById('total');
const whats=document.getElementById('whats');

function toNum(n){ return typeof n==='number'? n : Number(String(n).replace(/[^\d,.-]/g,'').replace(',', '.'))||0; }

function render(){
  const dados=JSON.parse(localStorage.getItem('dadosCliente')||'null');
  const cart=getCart();

  if(!dados){ window.location.href='identificacao.html'; return; }
  if(cart.length===0){ window.location.href='index.html'; return; }

  clienteBox.innerHTML = `
    <div><strong>Nome:</strong> ${dados.nome} ${dados.sobrenome}</div>
    <div><strong>Telefone:</strong> ${dados.telefone}</div>
    <div><strong>Cidade/UF:</strong> ${dados.cidade} - ${dados.estado}</div>
    <div><strong>CEP:</strong> ${dados.cep}</div>
    <div><strong>Endereço:</strong> ${dados.endereco}</div>
  `;

  resumo.innerHTML='';
  let total=0;
  cart.forEach(it=>{
    const unit=toNum(it.price), qty=Number(it.quantity||1), sub=unit*qty; total+=sub;
    const row=document.createElement('div');
    row.className='summary-row';
    row.innerHTML=`
      <div style="display:flex;gap:10px;align-items:center">
        <img src="${it.image}" alt="${it.name}">
        <div>
          <div><strong>${it.name}</strong></div>
          <div>Unitário: ${BRL.format(unit)} • Qtd: ${qty}</div>
        </div>
      </div>
      <div style="align-self:center"><strong>${BRL.format(sub)}</strong></div>
    `;
    resumo.appendChild(row);
  });
  totalEl.textContent='Total: '+BRL.format(total);
}

whats.addEventListener('click', ()=>{
  const dados=JSON.parse(localStorage.getItem('dadosCliente')||'{}');
  const cart = getCart();
  const total = cart.reduce((s,it)=> s + (toNum(it.price)*Number(it.quantity||1)), 0);
  const itens = cart.map(it=>`${it.name} x${it.quantity} (${BRL.format(toNum(it.price))})`).join(' | ');
  const msg = encodeURIComponent(
    `Olá, quero confirmar meu pedido.\n\nItens: ${itens}\nTotal: ${BRL.format(total)}\n\nDados:\n${dados.nome} ${dados.sobrenome}\n${dados.telefone}\n${dados.endereco} - ${dados.cidade}/${dados.estado}\nCEP: ${dados.cep}`
  );
  window.location.href = `https://wa.me/5511921905799?text=${msg}`;
});

window.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
